function Blowfish(key,mode){if(!this instanceof Blowfish)return new Blowfish(key,mode);if("string"==typeof key)key=new TextEncoder("utf-8").encode(key);else if(!(key instanceof Uint8Array))throw new TypeError("key must be a string or Uint8Array");if(key.length<4||key.length>56)throw new Error("key must be between 4 and 56 bytes");this.mode=mode||"ecb";this.iv=null;"cbc"===this.mode&&(this.iv=new Uint8Array(8));this._init(key)}Blowfish.prototype={_init:function(key){this.p=new Uint32Array(Blowfish.P);this.s0=new Uint32Array(Blowfish.S0);this.s1=new Uint32Array(Blowfish.S1);this.s2=new Uint32Array(Blowfish.S2);this.s3=new Uint32Array(Blowfish.S3);for(var i=0,j=0;i<18;i++)this.p[i]^=key[j++%key.length]|key[j++%key.length]<<8|key[j++%key.length]<<16|key[j++%key.length]<<24;for(i=0;i<18;i+=2){var t=this._encipher(0,0);this.p[i]=t[0];this.p[i+1]=t[1]}for(i=0;i<256;i+=2){t=this._encipher(this.s0[i],this.s0[i+1]);this.s0[i]=t[0];this.s0[i+1]=t[1]}for(i=0;i<256;i+=2){t=this._encipher(this.s1[i],this.s1[i+1]);this.s1[i]=t[0];this.s1[i+1]=t[1]}for(i=0;i<256;i+=2){t=this._encipher(this.s2[i],this.s2[i+1]);this.s2[i]=t[0];this.s2[i+1]=t[1]}for(i=0;i<256;i+=2){t=this._encipher(this.s3[i],this.s3[i+1]);this.s3[i]=t[0];this.s3[i+1]=t[1]}},_encipher:function(xl,xr){for(var i=0;i<16;i++){xl^=this.p[i];var f=((this.s0[xl>>>24]+this.s1[(xl>>>16)&0xff])^(this.s2[(xl>>>8)&0xff]))+this.s3[xl&0xff];xr^=f;xl^=this.p[i+1];f=((this.s0[xr>>>24]+this.s1[(xr>>>16)&0xff])^(this.s2[(xr>>>8)&0xff]))+this.s3[xr&0xff];xl^=f}xl^=this.p[16];xr^=this.p[17];return[xr,xl]},_decipher:function(xl,xr){for(var i=17;i>1;i--){xl^=this.p[i];var f=((this.s0[xl>>>24]+this.s1[(xl>>>16)&0xff])^(this.s2[(xl>>>8)&0xff]))+this.s3[xl&0xff];xr^=f;xl^=this.p[i-1];f=((this.s0[xr>>>24]+this.s1[(xr>>>16)&0xff])^(this.s2[(xr>>>8)&0xff]))+this.s3[xr&0xff];xl^=f}xl^=this.p[1];xr^=this.p[0];return[xr,xl]},encrypt:function(data){if("string"==typeof data)data=new TextEncoder("utf-8").encode(data);else if(!(data instanceof Uint8Array))throw new TypeError("data must be a string or Uint8Array");var padded=new Uint8Array(Math.ceil(data.length/8)*8);padded.set(data);for(var i=data.length;i<padded.length;i++)padded[i]=0;var result=new Uint8Array(padded.length);if("cbc"===this.mode){var xl=this.iv[0]|this.iv[1]<<8|this.iv[2]<<16|this.iv[3]<<24;var xr=this.iv[4]|this.iv[5]<<8|this.iv[6]<<16|this.iv[7]<<24;for(i=0;i<padded.length;i+=8){var block=new Uint8Array(padded.subarray(i,i+8));xl^=block[0]|block[1]<<8|block[2]<<16|block[3]<<24;xr^=block[4]|block[5]<<8|block[6]<<16|block[7]<<24;var t=this._encipher(xl,xr);xl=t[0];xr=t[1];result[i]=xl&0xff;result[i+1]=(xl>>>8)&0xff;result[i+2]=(xl>>>16)&0xff;result[i+3]=(xl>>>24)&0xff;result[i+4]=xr&0xff;result[i+5]=(xr>>>8)&0xff;result[i+6]=(xr>>>16)&0xff;result[i+7]=(xr>>>24)&0xff}}else{for(i=0;i<padded.length;i+=8){var block=new Uint8Array(padded.subarray(i,i+8));xl=block[0]|block[1]<<8|block[2]<<16|block[3]<<24;xr=block[4]|block[5]<<8|block[6]<<16|block[7]<<24;t=this._encipher(xl,xr);result[i]=t[0]&0xff;result[i+1]=(t[0]>>>8)&0xff;result[i+2]=(t[0]>>>16)&0xff;result[i+3]=(t[0]>>>24)&0xff;result[i+4]=t[1]&0xff;result[i+5]=(t[1]>>>8)&0xff;result[i+6]=(t[1]>>>16)&0xff;result[i+7]=(t[1]>>>24)&0xff}}return result},decrypt:function(data){if(!(data instanceof Uint8Array))throw new TypeError("data must be a Uint8Array");if(data.length%8!==0)throw new Error("data length must be a multiple of 8 bytes");var result=new Uint8Array(data.length);if("cbc"===this.mode){var xl=this.iv[0]|this.iv[1]<<8|this.iv[2]<<16|this.iv[3]<<24;var xr=this.iv[4]|this.iv[5]<<8|this.iv[6]<<16|this.iv[7]<<24;for(var i=0;i<data.length;i+=8){var block=new Uint8Array(data.subarray(i,i+8));var nextXl=block[0]|block[1]<<8|block[2]<<16|block[3]<<24;var nextXr=block[4]|block[5]<<8|block[6]<<16|block[7]<<24;var t=this._decipher(nextXl,nextXr);result[i]=(t[0]^xl)&0xff;result[i+1]=((t[0]^xl)>>>8)&0xff;result[i+2]=((t[0]^xl)>>>16)&0xff;result[i+3]=((t[0]^xl)>>>24)&0xff;result[i+4]=(t[1]^xr)&0xff;result[i+5]=((t[1]^xr)>>>8)&0xff;result[i+6]=((t[1]^xr)>>>16)&0xff;result[i+7]=((t[1]^xr)>>>24)&0xff;xl=nextXl;xr=nextXr}}else{for(i=0;i<data.length;i+=8){block=new Uint8Array(data.subarray(i,i+8));xl=block[0]|block[1]<<8|block[2]<<16|block[3]<<24;xr=block[4]|block[5]<<8|block[6]<<16|block[7]<<24;t=this._decipher(xl,xr);result[i]=t[0]&0xff;result[i+1]=(t[0]>>>8)&0xff;result[i+2]=(t[0]>>>16)&0xff;result[i+3]=(t[0]>>>24)&0xff;result[i+4]=t[1]&0xff;result[i+5]=(t[1]>>>8)&0xff;result[i+6]=(t[1]>>>16)&0xff;result[i+7]=(t[1]>>>24)&0xff}}var text=new TextDecoder("utf-8").decode(result);return text.replace(/\0+$/,"")}};Blowfish.P=new Uint32Array([0x243f6a88,0x85a308d3,0x13198a2e,0x03707344,0xa4093822,0x299f31d0,0x082efa98,0xec4e6c89,0x452821e6,0x38d01377,0xbe5466cf,0x34e90c6c,0xc0ac29b7,0xc97c50dd,0x3f84d5b5,0xb5470917,0x9216d5d9,0x8979fb1b]);Blowfish.S0=new Uint32Array([0xd1310ba6,0x98dfb5ac,0x2ffd72db,0xd01adfb7,0xb8e1afed,0x6a267e96,0xba7c9045,0xf12c7f99,0x24a19947,0xb3916cf7,0x0801f2e2,0x858efc16,0x636920d8,0x71574e69,0xa458fea3,0xf4933d7e,0x0d95748f,0x728eb658,0x718bcd58,0x82154aee,0x7b54a41d,0xc25a59b5,0x9c30d539,0x2af26013,0xc5d1b023,0x286085f0,0xca417918,0xb8db38ef,0x8e79dcb0,0x603a180e,0x6c9e0e8b,0xb01e8a3e,0xd71577c1,0xbd314b27,0x78af2fda,0x55605c60,0xe65525f3,0xaa55ab94,0x57489862,0x63e81440,0x55ca396a,0x2aab10b6,0xb4cc5c34,0x1141e8ce,0xa15486af,0x7c72e993,0xb3ee1411,0x636fbc2a,0x2ba9c55d,0x741831f6,0xce5c3e16,0x9b87931e,0xafd6ba33,0x6c24cf5c,0x7a325381,0x28958677,0x3b8f4898,0x6b4bb9af,0xc4bfe81b,0x66282193,0x61d809cc,0xfb21a991,0x487cac60,0x5dec8032,0xef845d5d,0xe98575b1,0xdc262302,0xeb651b88,0x23893e81,0xd396acc5,0x0f6d6ff3,0x83f44239,0x2e0b4482,0xa4842004,0x69c8f04a,0x9e1f9b5e,0x21c66842,0xf6e96c9a,0x670c9c61,0xabd388f0,0x6a51a0d2,0xd8542f68,0x960fa728,0xab5133a3,0x6eef0b6c,0x137a3be4,0xba3bf050,0x7efb2a98,0xa1f1651d,0x39af0176,0x66ca593e,0x82430e88,0x8cee8619,0x456f9fb4,0x7d84a5c3,0x3b8b5ebe,0xe06f75d8,0x85c12073,0x401a449f,0x56c16aa6,0x4ed3aa62,0x363f7706,0x1bfedf72,0x429b023d,0x37d0d724,0xd00a1248,0xdb0fead3,0x49f1c09b,0x075372c9,0x80991b7b,0x25d479d8,0xf6e8def7,0xe3fe501a,0xb6794c3b,0x976ce0bd,0x04c006ba,0xc1a94fb6,0x409f60c4,0x5e5c9ec2,0x196a2463,0x68fb6faf,0x3e6c53b5,0x1339b2eb,0x3b52ec6f,0x6dfc511f,0x9b30952c,0xcc814544,0xaf5ebd09,0xbee3d004,0xde334afd,0x660f2807,0x192e4bb3,0xc0cba857,0x45c8740f,0xd20b5f39,0xb9d3fbdb,0x5579c0bd,0x1a60320a,0xd6a100c6,0x402c7279,0x679f25fe,0xfb1fa3cc,0x8ea5e9f8,0xdb3222f8,0x3c7516df,0xfd616b15,0x2f501ec8,0xad0552ab,0x323db5fa,0xfd238760,0x53317b48,0x3e00df82,0x9e5c57bb,0xca6f8ca0,0x1a87562e,0xdf1769db,0xd542a8f6,0x287effc3,0xac6732c6,0x8c4f5573,0x695b27b0,0xbbca58c8,0xe1ffa35d,0xb8f011a0,0x10fa3d98,0xfd2183b8,0x4afcb56c,0x2dd1d35b,0x9a53e479,0xb6f84565,0xd28e49bc,0x4bfb9790,0xe1ddf2da,0xa4cb7e33,0x62fb1341,0xcee4c6e8,0xef20cada,0x36774c01,0xd07e9efe,0x2bf11fb4,0x95dbda4d,0xae909198,0xeaad8e71,0x6b93d5a0,0xd08ed1d0,0xafc725e0,0x8e3c5b2f,0x8e7594b7,0x8ff6e2fb,0xf2122b64,0x8888b812,0x900df01c,0x4fad5ea0,0x688fc31c,0xd1cff191,0xb3a8c1ad,0x2f2f2218,0xbe0e1777,0xea752dfe,0x8b021fa1,0xe5a0cc0f,0xb56f74e8,0x18acf3d6,0xce89e299,0xb4a84fe0,0xfd13e0b7,0x7cc43b81,0xd2ada8d9,0x165fa266,0x80957705,0x93cc7314,0x211a1477,0xe6ad2065,0x77b5fa86,0xc75442f5,0xfb9d35cf,0xebcdaf0c,0x7b3e89a0,0xd6411bd3,0xae1e7e49,0x00250e2d,0x2071b35e,0x226800bb,0x57b8e0af,0x2464369b,0xf009b91e,0x5563911d,0x59dfa6aa,0x78c14389,0xd95a537f,0x207d5ba2,0x02e5b9c5,0x83260376,0x6295cfa9,0x11c81968,0x4e734a41,0xb3472dca,0x7b14a94a,0x1b510052,0x9a532915,0xd60f573f,0xbc9bc6e4,0x2b60a476,0x81e67400,0x08ba6fb5,0x571be91f,0xf296ec6b,0x2a0dd915,0xb6636521,0xe7b9f9b6,0xff34052e,0xc5855664,0x53b02d5d,0xa99f8fa1,0x08ba4799,0x6e85076a]);Blowfish.S1=new Uint32Array([0x4b7a70e9,0xb5b32944,0xdb75092e,0xc4192623,0xad6ea6b0,0x49a7df7d,0x9cee60b8,0x8fedb266,0xecaa8c71,0x699a17ff,0x5664526c,0xc2b19ee1,0x193602a5,0x75094c29,0xa0591340,0xe4183a3e,0x3f54989a,0x5b429d65,0x6b8fe4d6,0x99f73fd6,0xa1d29c07,0xefe830f5,0x4d2d38e6,0xf0255dc1,0x4cdd2086,0x8470eb26,0x6382e9c6,0x021ecc5e,0x09686b3f,0x3ebaefc9,0x3c971814,0x6b6a70a1,0x687f3584,0x52a0e286,0xb79c5305,0xaa500737,0x3e07841c,0x7fdeae5c,0x8e7d44ec,0x5716f2b8,0xb03ada37,0xf0500c0d,0xf01c1f04,0x0200b3ff,0xae0cf51a,0x3cb574b2,0x25837a58,0xdc0921bd,0xd19113f9,0x7ca92ff6,0x94324773,0x22f54701,0x3ae5e581,0x37c2dadc,0xc8b57634,0x9af3dda7,0xa9446146,0x0fd0030e,0xecc8c73e,0xa4751e41,0xe238cd99,0x3bea0e2f,0x3280bba1,0x183eb331,0x4e548b38,0x4f6db908,0x6f420d03,0xf60a04bf,0x2cb81290,0x24977c79,0x5679b072,0xbcaf89af,0xde9a771f,0xd9930810,0xb38bae12,0xdccf3f2e,0x5512721f,0x2e6b7124,0x501adde6,0x9f84cd87,0x7a584718,0x7408da17,0xbc9f9abc,0xe94b7d8c,0xec7aec3a,0xdb851dfa,0x63094366,0xc464c3d2,0xef1c1847,0x3215d908,0xdd433b37,0x24c2ba16,0x12a14d43,0x2a65c451,0x50940002,0x133ae4dd,0x71dff89e,0x10314e55,0x81ac77d6,0x5f11199b,0x043556f1,0xd7a3c76b,0x3c11183b,0x5924a509,0xf28fe6ed,0x97f1fbfa,0x9ebabf2c,0x1e153c6e,0x86e34570,0xeae96fb1,0x860e5e0a,0x5a3e2ab3,0x771fe71c,0x4e3d06fa,0x2965dcb9,0x99e71d0f,0x803e89d6,0x5266c825,0x2e4cc978,0x9c10b36a,0xc6150eba,0x94e2ea78,0xa5fc3c53,0x1e0a2df4,0xf2f74ea7,0x361d2b3d,0x1939260f,0x19c27960,0x5223a708,0xf71312b6,0xebadfe6e,0xeac31f66,0xe3bc4595,0xa67bc883,0xb17f37d1,0x018cff28,0xc332ddef,0xbe6c5aa5,0x65582185,0x68ab9802,0xeecea50f,0xdb2f953b,0x2aef7dad,0x5b6e2f84,0x1521b628,0x29076170,0xecd3b53d,0x2c1e2b3a,0x3b1d2e5e,0x4e6e2c9b,0x5d2e3c2f,0x6c3e2e5d,0x7d2e3c7f,0x8e2e3c9e,0x9f2e3cb0,0x102e3cd2,0x212e3cf4,0x322e3d16,0x432e3d38,0x542e3d5a,0x652e3d7c,0x762e3d9e,0x872e3dc0,0x982e3de2,0xa92e3e04,0xba2e3e26,0xcb2e3e48,0xdc2e3e6a,0xed2e3e8c,0xfe2e3eae]);Blowfish.S2=new Uint32Array([0x4b7a70e9,0xb5b32944,0xdb75092e,0xc4192623,0xad6ea6b0,0x49a7df7d,0x9cee60b8,0x8fedb266,0xecaa8c71,0x699a17ff,0x5664526c,0xc2b19ee1,0x193602a5,0x75094c29,0xa0591340,0xe4183a3e,0x3f54989a,0x5b429d65,0x6b8fe4d6,0x99f73fd6,0xa1d29c07,0xefe830f5,0x4d2d38e6,0xf0255dc1,0x4cdd2086,0x8470eb26,0x6382e9c6,0x021ecc5e,0x09686b3f,0x3ebaefc9,0x3c971814,0x6b6a70a1,0x687f3584,0x52a0e286,0xb79c5305,0xaa500737,0x3e07841c,0x7fdeae5c,0x8e7d44ec,0x5716f2b8,0xb03ada37,0xf0500c0d,0xf01c1f04,0x0200b3ff,0xae0cf51a,0x3cb574b2,0x25837a58,0xdc0921bd,0xd19113f9,0x7ca92ff6,0x94324773,0x22f54701,0x3ae5e581,0x37c2dadc,0xc8b57634,0x9af3dda7,0xa9446146,0x0fd0030e,0xecc8c73e,0xa4751e41,0xe238cd99,0x3bea0e2f,0x3280bba1,0x183eb331,0x4e548b38,0x4f6db908,0x6f420d03,0xf60a04bf,0x2cb81290,0x24977c79,0x5679b072,0xbcaf89af,0xde9a771f,0xd9930810,0xb38bae12,0xdccf3f2e,0x5512721f,0x2e6b7124,0x501adde6,0x9f84cd87,0x7a584718,0x7408da17,0xbc9f9abc,0xe94b7d8c,0xec7aec3a,0xdb851dfa,0x63094366,0xc464c3d2,0xef1c1847,0x3215d908,0xdd433b37,0x24c2ba16,0x12a14d43,0x2a65c451,0x50940002,0x133ae4dd,0x71dff89e,0x10314e55,0x81ac77d6,0x5f11199b,0x043556f1,0xd7a3c76b,0x3c11183b,0x5924a509,0xf28fe6ed,0x97f1fbfa,0x9ebabf2c,0x1e153c6e,0x86e34570,0xeae96fb1,0x860e5e0a,0x5a3e2ab3,0x771fe71c,0x4e3d06fa,0x2965dcb9,0x99e71d0f,0x803e89d6,0x5266c825,0x2e4cc978,0x9c10b36a,0xc6150eba,0x94e2ea78,0xa5fc3c53,0x1e0a2df4,0xf2f74ea7,0x361d2b3d,0x1939260f,0x19c27960,0x5223a708,0xf71312b6,0xebadfe6e,0xeac31f66,0xe3bc4595,0xa67bc883,0xb17f37d1,0x018cff28,0xc332ddef,0xbe6c5aa5,0x65582185,0x68ab9802,0xeecea50f,0xdb2f953b,0x2aef7dad,0x5b6e2f84,0x1521b628,0x29076170,0xecd3b53d,0x2c1e2b3a,0x3b1d2e5e,0x4e6e2c9b,0x5d2e3c2f,0x6c3e2e5d,0x7d2e3c7f,0x8e2e3c9e,0x9f2e3cb0,0x102e3cd2,0x212e3cf4,0x322e3d16,0x432e3d38,0x542e3d5a,0x652e3d7c,0x762e3d9e,0x872e3dc0,0x982e3de2,0xa92e3e04,0xba2e3e26,0xcb2e3e48,0xdc2e3e6a,0xed2e3e8c,0xfe2e3eae]);Blowfish.S3=new Uint32Array([0x4b7a70e9,0xb5b32944,0xdb75092e,0xc4192623,0xad6ea6b0,0x49a7df7d,0x9cee60b8,0x8fedb266,0xecaa8c71,0x699a17ff,0x5664526c,0xc2b19ee1,0x193602a5,0x75094c29,0xa0591340,0xe4183a3e,0x3f54989a,0x5b429d65,0x6b8fe4d6,0x99f73fd6,0xa1d29c07,0xefe830f5,0x4d2d38e6,0xf0255dc1,0x4cdd2086,0x8470eb26,0x6382e9c6,0x021ecc5e,0x09686b3f,0x3ebaefc9,0x3c971814,0x6b6a70a1,0x687f3584,0x52a0e286,0xb79c5305,0xaa500737,0x3e07841c,0x7fdeae5c,0x8e7d44ec,0x5716f2b8,0xb03ada37,0xf0500c0d,0xf01c1f04,0x0200b3ff,0xae0cf51a,0x3cb574b2,0x25837a58,0xdc0921bd,0xd19113f9,0x7ca92ff6,0x94324773,0x22f54701,0x3ae5e581,0x37c2dadc,0xc8b57634,0x9af3dda7,0xa9446146,0x0fd0030e,0xecc8c73e,0xa4751e41,0xe238cd99,0x3bea0e2f,0x3280bba1,0x183eb331,0x4e548b38,0x4f6db908,0x6f420d03,0xf60a04bf,0x2cb81290,0x24977c79,0x5679b072,0xbcaf89af,0xde9a771f,0xd9930810,0xb38bae12,0xdccf3f2e,0x5512721f,0x2e6b7124,0x501adde6,0x9f84cd87,0x7a584718,0x7408da17,0xbc9f9abc,0xe94b7d8c,0xec7aec3a,0xdb851dfa,0x63094366,0xc464c3d2,0xef1c1847,0x3215d908,0xdd433b37,0x24c2ba16,0x12a14d43,0x2a65c451,0x50940002,0x133ae4dd,0x71dff89e,0x10314e55,0x81ac77d6,0x5f11199b,0x043556f1,0xd7a3c76b,0x3c11183b,0x5924a509,0xf28fe6ed,0x97f1fbfa,0x9ebabf2c,0x1e153c6e,0x86e34570,0xeae96fb1,0x860e5e0a,0x5a3e2ab3,0x771fe71c,0x4e3d06fa,0x2965dcb9,0x99e71d0f,0x803e89d6,0x5266c825,0x2e4cc978,0x9c10b36a,0xc6150eba,0x94e2ea78,0xa5fc3c53,0x1e0a2df4,0xf2f74ea7,0x361d2b3d,0x1939260f,0x19c27960,0x5223a708,0xf71312b6,0xebadfe6e,0xeac31f66,0xe3bc4595,0xa67bc883,0xb17f37d1,0x018cff28,0xc332ddef,0xbe6c5aa5,0x65582185,0x68ab9802,0xeecea50f,0xdb2f953b,0x2aef7dad,0x5b6e2f84,0x1521b628,0x29076170,0xecd3b53d,0x2c1e2b3a,0x3b1d2e5e,0x4e6e2c9b,0x5d2e3c2f,0x6c3e2e5d,0x7d2e3c7f,0x8e2e3c9e,0x9f2e3cb0,0x102e3cd2,0x212e3cf4,0x322e3d16,0x432e3d38,0x542e3d5a,0x652e3d7c,0x762e3d9e,0x872e3dc0,0x982e3de2,0xa92e3e04,0xba2e3e26,0xcb2e3e48,0xdc2e3e6a,0xed2e3e8c,0xfe2e3eae]);
